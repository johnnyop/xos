C51 COMPILER V9.00   TEST                                                                  07/30/2011 11:47:59 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE TEST
OBJECT MODULE PLACED IN .\temp\test.obj
COMPILER INVOKED BY: G:\Keil 4 C51\C51\BIN\C51.EXE src\test.c OMF2 BROWSE INCDIR(.\inc;.\inc\xlib;.\inc\kernel) DEBUG PR
                    -INT(.\temp\test.lst) OBJECT(.\temp\test.obj)

line level    source

   1          #include "xos_opt.h"   
   2          #include "uart.h"
   3          #include "type.h"
   4          #include "xos.h"
   5          #include "sem.h"
   6          #include "xlib.h"
   7          #include "12864.h"
   8          #include <absacc.h> 
   9          #include <reg52.h>       
  10          /**/            
  11          #ifdef SEMPHORE
              semphore sem = { 0, 0 };
              #endif //SEMPHORE
  14          
  15          
  16          #if SHOW_PIC
              unsigned char code tab5[]={
              0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
              0x00,0x1E,0x00,0x00,0x00,0x00,0x00,0x07,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
              0x00,0x7F,0x80,0x00,0x00,0x00,0x00,0x18,0x0C,0x00,0x00,0x01,0x00,0x00,0x00,0x00,
              0x01,0xFF,0x80,0x00,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x13,0x10,0x03,0xFE,0x00,
              0x03,0xFF,0xC0,0x00,0x00,0x00,0x00,0x58,0x00,0x00,0x00,0x3F,0x30,0x1F,0xFF,0xC0,
              0x03,0xFF,0xE0,0x00,0x00,0x00,0x00,0x8C,0x03,0xF0,0x00,0x7F,0xE0,0x7C,0x01,0xE0,
              0x03,0xFF,0xF0,0x00,0x00,0x00,0x01,0x36,0x06,0xC0,0x00,0x5F,0xC0,0xFF,0xFC,0x60,
              0x01,0xFF,0xF0,0x00,0x00,0x00,0x02,0x1B,0x0F,0x80,0x00,0xFF,0x01,0xFE,0x0F,0x30,
              0x00,0xEF,0xF0,0x00,0x00,0x00,0x02,0x6D,0x9F,0x00,0x00,0x3E,0x03,0xFF,0xF1,0x90,
              0x00,0xFF,0xF8,0x00,0x00,0x00,0x04,0x36,0xFE,0x00,0x01,0xFF,0x07,0xFF,0xFC,0x90,
              0x00,0xEF,0xFF,0xFF,0x80,0x00,0x04,0xDB,0x7E,0x00,0x03,0xFF,0x87,0xFF,0xFC,0xD0,
              0x00,0x0F,0xFF,0xFF,0xC0,0x00,0x04,0x6D,0xFC,0x00,0x07,0xFF,0x8F,0xFF,0xFE,0x50,
              0x00,0x0F,0xFF,0xFF,0xE0,0x00,0x04,0x36,0xFC,0x10,0x07,0xFF,0x8F,0xFF,0xFE,0x90,
              0x00,0x0F,0xFF,0xFF,0xE0,0x00,0x04,0x1B,0xF8,0x10,0x07,0xFF,0xCF,0xFF,0xFE,0x80,
              0x00,0x0F,0xFF,0xFF,0xF0,0x00,0x04,0x0F,0xF8,0x10,0x07,0xFF,0xFF,0xFF,0xFA,0x00,
              0x00,0x07,0xFF,0xFF,0xF0,0x00,0x04,0x07,0xF0,0x10,0x07,0xFF,0xFF,0xFF,0xFA,0x00,
              0x00,0xFF,0xFF,0xFF,0xF8,0x00,0x02,0x03,0xF0,0x20,0x07,0xFF,0xFF,0xFF,0xBA,0x00,
              0x00,0xFD,0xFF,0xFF,0xFC,0x00,0x02,0x03,0xF0,0x20,0x03,0xFF,0xFF,0xDF,0xB8,0x00,
              0x00,0xC1,0xC0,0x3F,0xFC,0x00,0x01,0x01,0xE0,0x40,0x00,0xFF,0xFF,0xDF,0xB0,0x00,
              0x00,0x81,0xC0,0x3F,0xCE,0x00,0x00,0x81,0xE0,0x80,0x00,0x7F,0xFF,0xDF,0xA0,0x00,
              0x00,0x81,0x80,0x1D,0xCF,0x00,0x00,0x41,0xE1,0x00,0x00,0x3F,0xFF,0x9B,0x00,0x00,
              0x01,0x83,0x80,0x1F,0xC7,0x80,0x00,0x21,0xE2,0x00,0x00,0x1F,0xFD,0xB6,0x00,0x00,
              0x01,0xC3,0x00,0x0E,0xE6,0x80,0x00,0x19,0xEC,0x00,0x00,0x07,0xFE,0x20,0x00,0x00,
              0x00,0xC3,0x00,0x07,0x67,0x40,0x00,0x07,0xF0,0x00,0x00,0x03,0x3E,0x00,0x00,0x00,
              0x00,0x02,0x00,0x03,0xE7,0xA0,0x00,0x00,0x00,0x00,0x00,0x02,0x8E,0x00,0x00,0x00,
              0x00,0x06,0x00,0x03,0x83,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x03,0x00,0x00,0x00,
              0x00,0x06,0x00,0x07,0x03,0x00,0x77,0x46,0x74,0x24,0x80,0x06,0x04,0x00,0x00,0x00,
              0x00,0x1C,0x00,0x06,0x00,0x00,0x55,0x45,0x54,0x57,0x80,0x00,0x00,0x00,0x00,0x00,
              0x00,0x1C,0x00,0x0E,0x00,0x00,0x45,0x45,0x74,0x57,0x80,0x08,0x00,0x00,0x00,0x00,
              0x00,0x00,0x00,0x1C,0x00,0x00,0x55,0x45,0x44,0x74,0x80,0xF0,0x00,0x00,0x00,0x00,
              0x00,0x00,0x00,0x38,0x00,0x00,0x77,0x76,0x47,0x54,0x80,0x00,0x00,0x00,0x00,0x00,
              0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
              0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
              0x00,0x1E,0x00,0x00,0x00,0x00,0x00,0x07,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
              0x00,0x7F,0x80,0x00,0x00,0x00,0x00,0x18,0x0C,0x00,0x00,0x01,0x00,0x00,0x00,0x00,
              0x01,0xFF,0x80,0x00,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x13,0x10,0x03,0xFE,0x00,
              0x03,0xFF,0xC0,0x00,0x00,0x00,0x00,0x58,0x00,0x00,0x00,0x3F,0x30,0x1F,0xFF,0xC0,
C51 COMPILER V9.00   TEST                                                                  07/30/2011 11:47:59 PAGE 2   

              0x03,0xFF,0xE0,0x00,0x00,0x00,0x00,0x8C,0x03,0xF0,0x00,0x7F,0xE0,0x7C,0x01,0xE0,
              0x03,0xFF,0xF0,0x00,0x00,0x00,0x01,0x36,0x06,0xC0,0x00,0x5F,0xC0,0xFF,0xFC,0x60,
              0x01,0xFF,0xF0,0x00,0x00,0x00,0x02,0x1B,0x0F,0x80,0x00,0xFF,0x01,0xFE,0x0F,0x30,
              0x00,0xEF,0xF0,0x00,0x00,0x00,0x02,0x6D,0x9F,0x00,0x00,0x3E,0x03,0xFF,0xF1,0x90,
              0x00,0xFF,0xF8,0x00,0x00,0x00,0x04,0x36,0xFE,0x00,0x01,0xFF,0x07,0xFF,0xFC,0x90,
              0x00,0xEF,0xFF,0xFF,0x80,0x00,0x04,0xDB,0x7E,0x00,0x03,0xFF,0x87,0xFF,0xFC,0xD0,
              0x00,0x0F,0xFF,0xFF,0xC0,0x00,0x04,0x6D,0xFC,0x00,0x07,0xFF,0x8F,0xFF,0xFE,0x50,
              0x00,0x0F,0xFF,0xFF,0xE0,0x00,0x04,0x36,0xFC,0x10,0x07,0xFF,0x8F,0xFF,0xFE,0x90,
              0x00,0x0F,0xFF,0xFF,0xE0,0x00,0x04,0x1B,0xF8,0x10,0x07,0xFF,0xCF,0xFF,0xFE,0x80,
              0x00,0x0F,0xFF,0xFF,0xF0,0x00,0x04,0x0F,0xF8,0x10,0x07,0xFF,0xFF,0xFF,0xFA,0x00,
              0x00,0x07,0xFF,0xFF,0xF0,0x00,0x04,0x07,0xF0,0x10,0x07,0xFF,0xFF,0xFF,0xFA,0x00,
              0x00,0xFF,0xFF,0xFF,0xF8,0x00,0x02,0x03,0xF0,0x20,0x07,0xFF,0xFF,0xFF,0xBA,0x00,
              0x00,0xFD,0xFF,0xFF,0xFC,0x00,0x02,0x03,0xF0,0x20,0x03,0xFF,0xFF,0xDF,0xB8,0x00,
              0x00,0xC1,0xC0,0x3F,0xFC,0x00,0x01,0x01,0xE0,0x40,0x00,0xFF,0xFF,0xDF,0xB0,0x00,
              0x00,0x81,0xC0,0x3F,0xCE,0x00,0x00,0x81,0xE0,0x80,0x00,0x7F,0xFF,0xDF,0xA0,0x00,
              0x00,0x81,0x80,0x1D,0xCF,0x00,0x00,0x41,0xE1,0x00,0x00,0x3F,0xFF,0x9B,0x00,0x00,
              0x01,0x83,0x80,0x1F,0xC7,0x80,0x00,0x21,0xE2,0x00,0x00,0x1F,0xFD,0xB6,0x00,0x00,
              0x01,0xC3,0x00,0x0E,0xE6,0x80,0x00,0x19,0xEC,0x00,0x00,0x07,0xFE,0x20,0x00,0x00,
              0x00,0xC3,0x00,0x07,0x67,0x40,0x00,0x07,0xF0,0x00,0x00,0x03,0x3E,0x00,0x00,0x00,
              0x00,0x02,0x00,0x03,0xE7,0xA0,0x00,0x00,0x00,0x00,0x00,0x02,0x8E,0x00,0x00,0x00,
              0x00,0x06,0x00,0x03,0x83,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x03,0x00,0x00,0x00,
              0x00,0x06,0x00,0x07,0x03,0x00,0x77,0x46,0x74,0x24,0x80,0x06,0x04,0x00,0x00,0x00,
              0x00,0x1C,0x00,0x06,0x00,0x00,0x55,0x45,0x54,0x57,0x80,0x00,0x00,0x00,0x00,0x00,
              0x00,0x1C,0x00,0x0E,0x00,0x00,0x45,0x45,0x74,0x57,0x80,0x08,0x00,0x00,0x00,0x00,
              0x00,0x00,0x00,0x1C,0x00,0x00,0x55,0x45,0x44,0x74,0x80,0xF0,0x00,0x00,0x00,0x00,
              0x00,0x00,0x00,0x38,0x00,0x00,0x77,0x76,0x47,0x54,0x80,0x00,0x00,0x00,0x00,0x00,
              0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
              };                               
              void pps(u8_t *img);
              #endif
  85          //void pr_imageZY(unsigned char *dat,unsigned char k);
  86          unsigned char sb = 0, sb2 = 0;
  87          static void t1() { /**/
  88   1              u8_t sx = 0, sb = 1, sy = 62;
  89   1              P0 = 0x01;
  90   1              init_uart(0xfd, 0);     
  91   1              //P0 = 1 << 1;
  92   1              init_12864();   
  93   1              //P0 = 1 << 2;
  94   1              clear_lcd();
  95   1              //P0 = 1 << 3;   
  96   1              //printstr(0, 0, 0, "123");     
  97   1              draw_point(1, 0, 1);
  98   1              draw_point(2, 0, 1);
  99   1              draw_point(0, 1, 1);
 100   1              draw_point(1, 2, 1);
 101   1              draw_point(2, 3, 1);
 102   1              draw_point(0, 4, 1);
 103   1              draw_point(1, 4, 1);
 104   1      #if SHOW_PIC    
                      pps(tab5);
              #endif
 107   1              while (1) {
 108   2                      //do_stuff(0);          
 109   2                      //sem_down(&sem);
 110   2                      //P0 = ~1;
 111   2                      sleep(HZ >> 1);  
 112   2                      if (sb && sx > 60) {
 113   3                              sb = 0;
 114   3                      } else if (!sb && sx == 0) {
 115   3                              sb = 1;
 116   3                              sy -= 10;
C51 COMPILER V9.00   TEST                                                                  07/30/2011 11:47:59 PAGE 3   

 117   3                      }
 118   2                      draw_point(sx, sy, sb);
 119   2                      if (sb) ++sx;
 120   2                      else --sx;
 121   2                      //--sy;
 122   2                      //draw_point(22, 23, 1);
 123   2              } 
 124   1      }
 125          static 
 126          void t2() { /**/
 127   1              while (1) {
 128   2                      //do_stuff(1);     
 129   2                      sleep(HZ); 
 130   2                      SBUF = 1;
 131   2                      //SBUF = rand();
 132   2                      //printstr(0, rand() % 4, 0, "123");
 133   2                      //SBUF = ++sb2;
 134   2                      //P0 = ~(1 << 2);
 135   2                      //if (P1 > 2) {
 136   2                      //      sem_up(&sem, 1);
 137   2                      //}
 138   2                      //sleep(HZ);
 139   2              } /**
 140   1               while (1) {
 141   1               prints(6,0, "T1");
 142   1               sleep(HZ);
 143   1               }
 144   1               /**/
 145   1      }
 146          static
 147          void delay(int n) {
 148   1              int i;
 149   1              for (n; n > 0; n--)
 150   1                      for (i = 4; i > 0; i--)
 151   1                              ;
 152   1      }
 153          u16_t tcnt = 0;
 154          static 
 155          void t3() { /**/
 156   1              //schedule();     
 157   1              while (1) {
 158   2                      //do_stuff(2);    
 159   2                      //sem_down(&sem2);
 160   2                      //sem_down(&sem);        
 161   2                      //do_t3();
 162   2                      //P2++;
 163   2                      //if (P2 > 2)
 164   2                      //      sem_up(&sem, 1);
 165   2                      // 
 166   2                      //SBUF = ++P2;
 167   2                      //delay(1);  
 168   2                      //while (1) ++tcnt;
 169   2                      sleep(HZ / 3 + 25);
 170   2                      //P0 = ~(1 << 3);
 171   2              }
 172   1              /**             
 173   1               while (1) {
 174   1               prints(0,1, "T1");
 175   1               sleep(HZ);
 176   1               }
 177   1               /**/
 178   1      }
C51 COMPILER V9.00   TEST                                                                  07/30/2011 11:47:59 PAGE 4   

 179          static
 180          void t4() {
 181   1              /**
 182   1               while(1) {
 183   1               do_stuff(3);
 184   1               //schedule();
 185   1               P3++;
 186   1               //if (P3 > 4)
 187   1               //     sem_up(&sem2, 1);
 188   1               sleep(HZ);
 189   1               }
 190   1               /**/
 191   1              while (1) {
 192   2                      //prints(6,1, "T1");
 193   2                      sleep(10);
 194   2                      //SBUF = tcnt;
 195   2                      //P0 = ~(1 << 4);
 196   2              }
 197   1      }
 198          void main() {  
 199   1              ETN = 0;
 200   1                      //init_uart(0xfd, 1);   
 201   1                      //SBUF = ++P2;
 202   1              add_task((u16_t) t1);
 203   1              add_task((u16_t) t2);
 204   1              add_task((u16_t) t3);
 205   1              add_task((u16_t) t4);
 206   1              xos_init();
 207   1      }
 208          
 209          void com_uart(void) interrupt 4
 210          {
 211   1              /*                      接收数据中断                                            */
 212   1              disable_irq();
 213   1              if(RI)   {
 214   2                      RI=0;
 215   2              }  else if(TI) {/*          发送数据中断                        */
 216   2                      TI=0;   
 217   2              }
 218   1              enable_irq();
 219   1      }
 220          /**/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    267    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
